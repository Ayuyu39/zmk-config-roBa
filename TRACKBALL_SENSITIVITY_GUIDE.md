# トラックボール X軸・Y軸独立感度設定ガイド

## 概要

roBaキーボードのPMW3610トラックボールは、X軸（横方向）とY軸（縦方向）の感度を独立して調整できます。

## 設定ファイル

- **編集対象**: `boards/shields/roBa/roBa_R.conf`
- **対象行**: `CONFIG_PMW3610_CPI_*` で始まる設定

## 基本設定

### グローバルCPI設定（従来の方法）

X軸とY軸の両方を同じ感度で設定する場合：

```properties
CONFIG_PMW3610_CPI=400  # 両軸のCPI（各軸は400に設定）
```

### X軸・Y軸独立CPI設定（新方法）

X軸とY軸を異なる感度で設定する場合：

```properties
# X軸（横方向）のCPI
CONFIG_PMW3610_CPI_X=300

# Y軸（縦方向）のCPI  
CONFIG_PMW3610_CPI_Y=400
```

**重要**: `CONFIG_PMW3610_CPI_X` と `CONFIG_PMW3610_CPI_Y` を設定すると、`CONFIG_PMW3610_CPI` の設定は無視されます。

---

## 使用例

### パターン1: 精密作業向け（横方向を減感）

テキスト選択やボタンクリックなど、細かい操作が必要な場合。

```properties
CONFIG_PMW3610_CPI_X=300    # 横方向：低感度
CONFIG_PMW3610_CPI_Y=400    # 縦方向：標準感度
```

**効果**: 
- ✅ 横方向の誤操作が減少
- ✅ 細かいクリックが正確になる
- ⚠️ 横方向の移動が遅くなる

---

### パターン2: スクロール中心（縦方向を減感）

WebサイトのスクロールやPDF閲覧が中心の場合。

```properties
CONFIG_PMW3610_CPI_X=400    # 横方向：標準感度
CONFIG_PMW3610_CPI_Y=300    # 縦方向：低感度（スクロール用）
```

**効果**:
- ✅ 垂直スクロールが滑らか
- ✅ スクロール量を微調整しやすい
- ⚠️ 縦方向の高速移動が遅くなる

---

### パターン3: ゲーム向け（高感度）

FPSゲームなど、素早い操作が必要な場合。

```properties
CONFIG_PMW3610_CPI_X=600    # 横方向：高感度
CONFIG_PMW3610_CPI_Y=600    # 縦方向：高感度
```

**効果**:
- ✅ 素早い視点操作が可能
- ✅ 反応迷度が向上
- ⚠️ 誤操作のリスクが増加

---

### パターン4: 非対象感度（カスタム例）

特定用途に応じた細かい調整。

```properties
CONFIG_PMW3610_CPI_X=350    # 横方向：やや低感度
CONFIG_PMW3610_CPI_Y=450    # 縦方向：やや高感度
```

---

## CPI値の推奨範囲

| 感度レベル | CPI値 | 用途 |
|----------|-------|------|
| **超低感度** | 100-200 | CAD・設計・イラスト（高精度必須） |
| **低感度** | 200-300 | テキスト編集・精密作業 |
| **標準** | 300-500 | 一般的なPC作業（オフィス・Web） |
| **高感度** | 500-800 | ゲーム・メディア編集 |
| **超高感度** | 800+ | FPS/アクションゲーム |

---

## 高度な設定: CPI ディバイダー

CPI値を変更したくない場合、ディバイダーで感度を調整できます。

### グローバルディバイダー

```properties
CONFIG_PMW3610_CPI=400
CONFIG_PMW3610_CPI_DIVIDOR=2  # 感度が 400/2 = 200 になる
```

### X軸・Y軸独立ディバイダー

```properties
CONFIG_PMW3610_CPI_X=400
CONFIG_PMW3610_CPI_Y=400
CONFIG_PMW3610_CPI_X_DIVIDOR=1  # X軸：400そのまま
CONFIG_PMW3610_CPI_Y_DIVIDOR=2  # Y軸：400/2 = 200
```

**結果**:
- X軸実効感度: 400
- Y軸実効感度: 200

---

## 設定の反映方法

### 方法1: ファイル編集（ビルド時に反映）

1. `boards/shields/roBa/roBa_R.conf` を開く
2. `CONFIG_PMW3610_CPI_X` と `CONFIG_PMW3610_CPI_Y` の行をコメント解除
3. 値を編集
4. ZMKをビルド＆フラッシュ

```bash
# コメント解除例
CONFIG_PMW3610_CPI_X=300
CONFIG_PMW3610_CPI_Y=400
```

### 方法2: ZMK Studio（ランタイム変更）

ZMK Studioがサポートしている場合、再ビルド不要で動的に設定変更可能です。

---

## トラブルシューティング

### 設定が反映されない

**原因**: ファイル保存後にビルド・フラッシュしていない

**対策**:
1. ファイル保存を確認
2. キャッシュをクリア: `rm -rf build/`
3. 再ビルド＆フラッシュ

---

### X軸・Y軸の動きが逆

**原因**: `CONFIG_PMW3610_INVERT_X` または `CONFIG_PMW3610_INVERT_Y` の設定に誤りがある

**対策**: roBa_R.conf の反転設定を確認

```properties
CONFIG_PMW3610_INVERT_X=n  # n=反転なし, y=反転
CONFIG_PMW3610_INVERT_SCROLL_X=y
```

---

### 感度が正しく反映されていない

**原因**: 複数の相反する設定が同時に有効になっている

**確認項目**:
- [ ] `CONFIG_PMW3610_CPI_X` と `CONFIG_PMW3610_CPI_Y` が両方コメント解除されていないか
- [ ] `CONFIG_PMW3610_CPI_DIVIDOR` が予期しない値になっていないか
- [ ] ZMK Studioで上書きされていないか

---

## パフォーマンスへの影響

CPI設定による性能への影響はほぼありません。バッテリー消費やレイテンシーは**変わりません**。

---

## よくある質問

### Q: グローバルCPIとX軸・Y軸CPIを混在できますか？

**A**: いいえ。`CONFIG_PMW3610_CPI_X` または `CONFIG_PMW3610_CPI_Y` を設定すると、`CONFIG_PMW3610_CPI` は完全に無視されます。どちらか一方のみ使用してください。

### Q: リアルタイムに感度を変更できますか？

**A**: ZMK Studio が有効な場合は、Studio経由で変更可能です。そうでない場合は、ファイル編集→ビルド→フラッシュが必要です。

### Q: 推奨CPI値は？

**A**: 一般的なPC作業なら **300-400**、ゲームなら **500-800** をお勧めします。個人差が大きいため、複数試してみることをお勧めします。

---

## リセット方法

デフォルト設定に戻す場合：

```properties
# グローバル設定に戻す
CONFIG_PMW3610_CPI=400

# X軸・Y軸独立設定をコメント化
# CONFIG_PMW3610_CPI_X=400
# CONFIG_PMW3610_CPI_Y=400
```

---

## 関連設定

その他の重要なトラックボール設定:

| 設定 | 説明 |
|-----|------|
| `CONFIG_PMW3610_SCROLL_TICK` | スクロール感度（値が小さい=細かい） |
| `CONFIG_PMW3610_MOVEMENT_THRESHOLD` | 動き検知の最小閾値（ノイズ対策） |
| `CONFIG_PMW3610_SMART_ALGORITHM` | スマートアルゴリズム（自動感度調整） |

詳しくは **roBa_R.conf** 内のコメントを参照。

